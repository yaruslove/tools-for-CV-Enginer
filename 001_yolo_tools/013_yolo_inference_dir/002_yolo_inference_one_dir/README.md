# YOLO Inference Tool

Инструмент для выполнения инференса YOLO модели с сохранением лейблов в формате YOLO и опциональной визуализацией результатов детекции.

## Особенности

- Поддержка инференса YOLO модели на GPU/CPU
- Сохранение результатов в формате YOLO (txt файлы)
- Опциональная визуализация результатов детекции
- Настраиваемые параметры отображения (толщина линий, размер шрифта)
- Конфигурация через YAML файл

## Структура проекта

```
.
├── config.yaml           # Файл конфигурации
├── yolo_inference_dir.py # Основной скрипт
└── README.md            # Документация
```

## Установка

1. Установите необходимые зависимости:
```bash
pip install ultralytics opencv-python pyyaml torch
```

## Конфигурация

Настройте параметры в `config.yaml`:

```yaml
weights_yolo: "path/to/weights/best.pt"  # Путь к весам модели
src: "path/to/source/images"             # Директория с исходными изображениями
dst: "path/to/labels"                    # Директория для сохранения лейблов
device: 0                                # Номер GPU (-1 для CPU)

# Классы и их названия
classes: 
  0: 00_target_top
  1: 00_back_top
  2: 02_strip
  3: 03_coil

# Цвета для визуализации (RGB)
colors: [
  [255, 0, 0],    # класс 0 - красный
  [0, 255, 0],    # класс 1 - зеленый
  [0, 0, 255],    # класс 2 - синий
  [255, 255, 0]   # класс 3 - желтый
]

# Настройки визуализации
visulise:
  do: true                              # Включить/выключить визуализацию
  visulise_path: "path/to/vis"          # Путь для сохранения визуализаций
  box_thickness: 4                       # Толщина рамок
  font_scale: 1                         # Масштаб шрифта
  font_thickness: 2                     # Толщина шрифта

# Параметры модели YOLO
model_params:
  agnostic_nms: true                    # Агностичный NMS
  conf: 0.20                            # Порог уверенности
  iou: 0.2                              # Порог IoU
  show_conf: true                       # Показывать значение confidence
```

## Использование

1. Подготовьте директории:
   - Создайте директорию с исходными изображениями
   - Укажите путь для сохранения лейблов
   - При необходимости визуализации укажите путь для сохранения визуализаций

2. Настройте `config.yaml`:
   - Укажите пути к весам модели и директориям
   - Настройте классы и их цвета
   - Настройте параметры визуализации и модели

3. Запустите скрипт:
```bash
python yolo_inference_dir.py
```

## Формат выходных данных

### Лейблы (txt файлы)
- Каждая строка содержит: `class_id x_center y_center width height`
- Координаты нормализованы (0-1)
- Имя файла соответствует имени исходного изображения

### Визуализация
- Сохраняется с суффиксом "_vis"
- Содержит боксы с указанием класса и confidence
- Использует настроенные цвета для разных классов

## Примечания

- Поддерживаются форматы изображений: .jpg, .png
- При включенной визуализации создаются дополнительные файлы, что требует больше времени обработки
- Для работы с GPU требуется установленный CUDA

## Устранение неполадок

1. Если возникает ошибка CUDA:
   - Проверьте значение параметра `device` в конфигурации
   - Убедитесь, что CUDA установлен и определяется PyTorch

2. Если не создаются визуализации:
   - Проверьте параметр `visulise.do` в конфигурации
   - Убедитесь, что указанная директория существует и доступна для записи