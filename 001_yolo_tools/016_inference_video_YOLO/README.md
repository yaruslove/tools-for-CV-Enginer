# üöÄ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π YOLO Video Inference

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π batch processing pipeline –¥–ª—è YOLO object detection –Ω–∞ –≤–∏–¥–µ–æ —Å GPU acceleration –∏ memory optimization.

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **GPU-Accelerated Processing**: –ü–æ–ª–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è pipeline —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CUDA
- **Batch Inference**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–¥—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è GPU
- **Memory Loading**: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∏–¥–µ–æ (<2000 –∫–∞–¥—Ä–æ–≤) –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ RAM –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
- **Vectorized Operations**: –í—Å–µ coordinate transformations –∏ postprocessing –Ω–∞ GPU
- **Multi-GPU Support**: –£–∫–∞–∑–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ GPU —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (`cuda:0`, `cuda:1`, –∏ —Ç.–¥.)
- **Stream Processing**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –≤–∏–¥–µ–æ –±–µ–∑ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

```bash
pip install torch torchvision ultralytics opencv-python pyyaml tqdm numpy
```

## üõ† –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `config.yaml`:

```yaml
# –ü—É—Ç–∏ –≤—Ö–æ–¥–Ω—ã—Ö/–≤—ã—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
src_video: "input/video.mp4"     # –û–¥–∏–Ω —Ñ–∞–π–ª –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
dst_video: "output/result.mp4"   # –û–¥–∏–Ω —Ñ–∞–π–ª –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–∏
path_weight: "yolo11n.pt"        # –í–µ—Å–∞ YOLO –º–æ–¥–µ–ª–∏
conf: 0.25                       # –ü–æ—Ä–æ–≥ confidence
iou: 0.45                        # –ü–æ—Ä–æ–≥ IoU –¥–ª—è NMS
imgsz: 1280                      # –†–∞–∑–º–µ—Ä –≤—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å training)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
batch: 16                        # Batch size –¥–ª—è inference
device: "cuda:0"                 # –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: "auto", "cpu", "cuda:0", "cuda:1"
fp16: true                       # –í–∫–ª—é—á–∏—Ç—å FP16 precision (—Ç–æ–ª—å–∫–æ CUDA)
max_memory_frames: 2000          # –ó–∞–≥—Ä—É–∂–∞—Ç—å –≤ –ø–∞–º—è—Ç—å –µ—Å–ª–∏ –∫–∞–¥—Ä–æ–≤ <= —ç—Ç–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é (0 —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å)
```

## üèÉ‚Äç‚ôÇÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```bash
python yolo_video_inference.py
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ
```yaml
src_video: "input/video.mp4"
dst_video: "output/detected.mp4"
```

### Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```yaml
src_video: "input_videos/"
dst_video: "output_videos/"
```

## üß† –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –û—Å–Ω–æ–≤–Ω–æ–π Pipeline

1. **Video Loading**: –£–º–Ω–∞—è memory loading –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∏–¥–µ–æ, streaming –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö
2. **Batch Preprocessing**: Vectorized letterbox resize –Ω–∞ GPU
3. **Model Inference**: Batch prediction —Å YOLO
4. **Vectorized Postprocessing**: GPU-based coordinate unscaling –∏ NMS
5. **Output Writing**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∑–∞–ø–∏—Å—å –∫–∞–¥—Ä–æ–≤ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `letterbox_preprocess(frames, imgsz, device)`
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç BGR‚ÜíRGB –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∑–∞ –æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥
- –í—ã–ø–æ–ª–Ω—è–µ—Ç letterbox resize —Å padding –Ω–∞ GPU
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç preprocessed tensor + metadata –º–∞—Å—à—Ç–∞–±–∞

#### `postprocess_batch(frames, results, ratios, pads, device)`
- –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ detection –∏–∑ batch –≤ –æ–¥–∏–Ω tensor
- Vectorized coordinate unscaling —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º batch indices
- GPU-accelerated bounding box clipping
- –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø–æ–º–æ—â—å—é OpenCV

#### `load_frames_to_memory(video_path, max_frames)`
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å—ë –≤–∏–¥–µ–æ –≤ numpy array –¥–ª—è —Å–≤–µ—Ä—Ö–±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ streaming –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤–∏–¥–µ–æ
- –£—Å—Ç—Ä–∞–Ω—è–µ—Ç disk I/O bottleneck –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –∫–ª–∏–ø–æ–≤

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **O(1) Tensor Operations**: Vectorized coordinate transforms –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–æ–≤
- **Batch Processing**: –û–±—Ä–∞–±–æ—Ç–∫–∞ 16+ –∫–∞–¥—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ GPU
- **Memory Coalescing**: –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–µ tensor –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è GPU
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ CPU-GPU Transfers**: –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ GPU –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–≥–æ pipeline

### Memory –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **Smart Memory Loading**: RAM caching –¥–ª—è –≤–∏–¥–µ–æ <2000 –∫–∞–¥—Ä–æ–≤
- **Tensor Reuse**: –ò–∑–±–µ–≥–∞–Ω–∏–µ –ª–∏—à–Ω–∏—Ö allocations –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **Efficient Padding**: Single-pass letterbox —Å F.pad –≤–º–µ—Å—Ç–æ cv2 –æ–ø–µ—Ä–∞—Ü–∏–π

### GPU Acceleration
- **Full GPU Pipeline**: Preprocessing, inference, –∏ postprocessing –Ω–∞ GPU
- **FP16 Support**: ~25% —É—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ Tensor Core GPU
- **Device Affinity**: –ü—Ä–∏–≤—è–∑–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É GPU –¥–ª—è multi-GPU —Å–∏—Å—Ç–µ–º
- **Vectorized Clipping**: Batch coordinate clamping —Å torch.clamp

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞
- **Function Fusion**: –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–µ preprocessing —à–∞–≥–∏ —É–º–µ–Ω—å—à–∞—é—Ç overhead
- **Branching Reduction**: Vectorized –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—é—Ç —É—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É
- **Memory Access Patterns**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ tensor indexing –¥–ª—è cache efficiency

## üìä –û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –î–ª–∏–Ω–∞ –≤–∏–¥–µ–æ | –†–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ | –£—Å–∫–æ—Ä–µ–Ω–∏–µ vs –æ—Ä–∏–≥–∏–Ω–∞–ª |
|-------------|----------------|--------------------|
| <2000 –∫–∞–¥—Ä–æ–≤ | Memory Loading | ~2-3x –±—ã—Å—Ç—Ä–µ–µ |
| >2000 –∫–∞–¥—Ä–æ–≤ | Streaming | ~1.5-2x –±—ã—Å—Ç—Ä–µ–µ |
| Batch=16 | GPU Processing | ~4-6x vs batch=1 |
| FP16 –≤–∫–ª—é—á—ë–Ω | Tensor Cores | ~1.2-1.5x –±—ã—Å—Ç—Ä–µ–µ |

## üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Batch Size**: –£–≤–µ–ª–∏—á—å—Ç–µ –¥–æ 32-64 –µ—Å–ª–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç GPU memory
- **Image Size**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—Ä–∞—Ç–Ω—ã–µ 32 (640, 1280, 1920) –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ inference
- **Memory Loading**: –í–∫–ª—é—á–∞–π—Ç–µ –¥–ª—è training datasets –∏ –∫–æ—Ä–æ—Ç–∫–∏—Ö –∫–ª–∏–ø–æ–≤
- **FP16**: –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–π—Ç–µ –Ω–∞ RTX/A100 series GPU

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∂–µ–ª–µ–∑—É
- **RTX 4090**: `batch: 32, imgsz: 1280, fp16: true`
- **RTX 3080**: `batch: 16, imgsz: 1280, fp16: true`
- **GTX 1080**: `batch: 8, imgsz: 640, fp16: false`

### Multi-GPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```yaml
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ GPU
device: "cuda:1"

# –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö batch –∑–∞–¥–∞—á –ø–æ GPU –≤—Ä—É—á–Ω—É—é
# GPU 0: batch_start=0, batch_end=1000
# GPU 1: batch_start=1000, batch_end=2000
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| CUDA OOM | –£–º–µ–Ω—å—à–∏—Ç–µ `batch` size –∏–ª–∏ `imgsz` |
| –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ | –í–∫–ª—é—á–∏—Ç–µ `memory loading` –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∏–¥–µ–æ |
| GPU –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É CUDA –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É `device` |
| –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ detection | –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–æ–¥–µ–ª—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `imgsz` –∏–∑ training |

## üîß –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–π –º–æ–¥–µ–ª–∏
```python
model = YOLO("custom_model.pt")
model.conf = 0.3  # –ö–∞—Å—Ç–æ–º–Ω—ã–π confidence
model.iou = 0.5   # –ö–∞—Å—Ç–æ–º–Ω—ã–π IoU threshold
```

### Real-time Streaming
```python
# –î–ª—è –≤–µ–±-–∫–∞–º–µ—Ä—ã –∏–ª–∏ RTSP streams
src_video: "0"  # –í–µ–±-–∫–∞–º–µ—Ä–∞
src_video: "rtsp://camera_url"  # IP –∫–∞–º–µ—Ä–∞
```

---

**–ó–∞–º–µ—Ç–∫–∞ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: –î–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç–∏–≥–∞–µ—Ç 2-6x —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º YOLO inference –±–ª–∞–≥–æ–¥–∞—Ä—è vectorized –æ–ø–µ—Ä–∞—Ü–∏—è–º, batch processing –∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–º—É memory management –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏ detection.


